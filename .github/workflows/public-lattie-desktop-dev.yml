name: Public Lattie Desktop Dev Build

on:
  repository_dispatch:
    types: [public-lattie-desktop-dev]
  workflow_dispatch:
    inputs:
      ref:
        description: Branch, tag, or SHA to build (optional)
        required: false
        type: string
      include_metadata:
        description: Include electron-builder metadata/blockmap
        required: false
        type: boolean
        default: true

permissions:
  contents: read

concurrency:
  group: public-lattie-desktop-dev-${{ github.event.client_payload.sha || github.event.client_payload.ref || inputs.ref || github.run_id }}
  cancel-in-progress: true

jobs:
  prepare:
    uses: ./.github/workflows/public-shared-prepare.yml
    with:
      runner: ubuntu-latest
      target_ref: ${{ github.event.client_payload.ref || inputs.ref || 'refs/heads/develop' }}
      target_sha: ${{ github.event.client_payload.sha || '' }}

  macos:
    needs: prepare
    uses: ./.github/workflows/public-shared-macos.yml
    with:
      runner: macos-26
      checkout_ref: ${{ needs.prepare.outputs.checkout_ref }}
      short_sha: ${{ needs.prepare.outputs.short_sha }}
      include_metadata: ${{ inputs.include_metadata }}
      artifact_name: macos-dist-dev
      artifact_filename_suffix: ''
    secrets: inherit

  linux:
    needs: prepare
    uses: ./.github/workflows/public-shared-linux.yml
    with:
      runner: ubuntu-latest
      checkout_ref: ${{ needs.prepare.outputs.checkout_ref }}
      short_sha: ${{ needs.prepare.outputs.short_sha }}
      include_metadata: ${{ inputs.include_metadata }}
      artifact_name: linux-dist-dev
      artifact_filename_suffix: ''
    secrets: inherit

  windows:
    needs: prepare
    uses: ./.github/workflows/public-shared-windows.yml
    with:
      runner: windows-latest
      checkout_ref: ${{ needs.prepare.outputs.checkout_ref }}
      short_sha: ${{ needs.prepare.outputs.short_sha }}
      include_metadata: ${{ inputs.include_metadata }}
      artifact_name: windows-dist-dev
      artifact_filename_suffix: ''
    secrets: inherit
